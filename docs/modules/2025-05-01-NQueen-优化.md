# N皇后算法中断优化

- **日期**: 2025-05-01
- **作者**: ZhangJZ
- **变更类型**: 优化

## 相关文件
- src/main/java/com/multiplethread/judge/NQueen.java
- src/main/java/com/multiplethread/judge/TimedTask.java

## 变更描述
为N皇后算法添加了中断响应机制，使其能够在执行过程中检测并响应线程中断信号，主要变更包括：

1. 在N皇后递归算法中添加周期性检查线程中断状态的逻辑
2. 当检测到中断信号时，立即停止计算并抛出InterruptedException
3. 添加异常处理，确保中断能够正常传播到调用者
4. 引入递归计数器，控制中断检查频率，平衡性能与响应性

## 变更原因
在混合负载测试中发现，当N皇后算法处理较大规模问题（如N=16）时，即使通过TimedTask设置了超时机制，算法也无法被正确中断。这是因为N皇后算法是一个CPU密集型计算，在递归过程中没有检查线程中断状态的逻辑，导致超时机制无法有效工作。

## 设计决策
1. **周期性检查**：为了平衡性能与响应性，采用计数器方式，每执行1000次递归操作检查一次中断状态，避免频繁检查带来的性能开销
2. **异常传播**：使用标准的Java中断机制，通过抛出InterruptedException来中断计算流程
3. **结果标记**：当算法被中断时，返回特殊值-1，使调用者能明确区分正常结果和中断结果
4. **日志记录**：添加日志记录中断事件，便于问题诊断和性能分析

## 测试方法
1. 运行混合负载测试（TimeoutPerformanceTest.testMixedLoad()）验证优化后N皇后算法能否被正确中断
2. 检查测试结果中N=16的任务是否被正确中断且返回-1
3. 比较优化前后的系统响应时间，确认超时机制的有效性

## 未来工作
1. 考虑为不同规模的N皇后问题自适应调整中断检查频率
2. 探索更精确的计算量估计方法，自动为不同规模问题设置合理的超时阈值
3. 研究更高效的N皇后算法实现，减少大规模问题的计算时间 